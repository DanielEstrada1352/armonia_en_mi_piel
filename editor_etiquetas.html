<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editor de Etiquetas â€“ ArmonÃ­a en mi Piel</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Jost:wght@200;300;400;500;600&display=swap"
    rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* ========= RESET & BASE ========= */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #f0ede8;
      --panel: #faf9f6;
      --border: #ddd9d0;
      --accent: #3bc5b2;
      --accent2: #2db5a3;
      --text: #1e1e1e;
      --muted: #7a7570;
      --radius: 12px;
    }

    body {
      font-family: 'Jost', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ========= HEADER ========= */
    header {
      background: #1a2e2e;
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.25);
    }

    header .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    header img.hlogo {
      width: 42px;
      height: 42px;
      object-fit: contain;
      border-radius: 6px;
    }

    header h1 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 20px;
      font-weight: 400;
      color: #e0f5f2;
      letter-spacing: 0.04em;
    }

    header span.sub {
      font-size: 9px;
      color: #7ecfc4;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      display: block;
      margin-top: 1px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn-print,
    .btn-download {
      color: #fff;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      font-family: 'Jost', sans-serif;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .btn-print {
      background: #3bc5b2;
    }

    .btn-download {
      background: #2a9d8f;
    }

    .btn-print:hover {
      background: #4dd9c8;
      transform: translateY(-1px);
    }

    .btn-download:hover {
      background: #3bc5b2;
      transform: translateY(-1px);
    }

    .btn-print:active,
    .btn-download:active {
      transform: translateY(0);
    }

    /* ========= LAYOUT ========= */
    .app {
      flex: 1;
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 0;
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 24px;
      width: 100%;
      gap: 28px;
    }

    /* ========= PANEL EDITOR ========= */
    .editor-panel {
      background: var(--panel);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 28px;
      height: fit-content;
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.06);
    }

    .panel-title {
      font-size: 10px;
      color: var(--accent2);
      letter-spacing: 0.35em;
      text-transform: uppercase;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .field-group {
      margin-bottom: 20px;
    }

    .field-group label {
      display: block;
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 7px;
      font-weight: 500;
    }

    .field-group input,
    .field-group textarea {
      width: 100%;
      background: #fff;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      padding: 10px 13px;
      font-family: 'Jost', sans-serif;
      font-size: 13px;
      color: var(--text);
      transition: border-color 0.2s, box-shadow 0.2s;
      resize: none;
      line-height: 1.5;
    }

    .field-group input:focus,
    .field-group textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 197, 178, 0.15);
    }

    .field-group textarea {
      height: 75px;
    }

    /* â”€â”€â”€ TamaÃ±o etiqueta â”€â”€â”€ */
    .size-selector {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin-bottom: 20px;
    }

    .size-btn {
      background: #fff;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      padding: 9px 6px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Jost', sans-serif;
    }

    .size-btn .sz {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      display: block;
    }

    .size-btn .sl {
      font-size: 9px;
      color: var(--muted);
      letter-spacing: 0.1em;
    }

    .size-btn.active {
      border-color: var(--accent);
      background: rgba(59, 197, 178, 0.06);
      box-shadow: 0 0 0 3px rgba(59, 197, 178, 0.15);
    }

    .size-btn.active .sz {
      color: var(--accent);
    }

    /* â”€â”€â”€ Toggle logo â”€â”€â”€ */
    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 12px 14px;
      background: #fff;
      border: 1.5px solid var(--border);
      border-radius: 8px;
    }

    .toggle-row span {
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.05em;
    }

    .toggle {
      position: relative;
      width: 40px;
      height: 22px;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-track {
      position: absolute;
      inset: 0;
      background: #ddd;
      border-radius: 22px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .toggle input:checked+.toggle-track {
      background: var(--accent);
    }

    .toggle-track::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .toggle input:checked+.toggle-track::after {
      transform: translateX(18px);
    }

    .divider-label {
      font-size: 10px;
      color: var(--accent2);
      letter-spacing: 0.3em;
      text-transform: uppercase;
      margin: 24px 0 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .divider-label::before,
    .divider-label::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* â”€â”€â”€ Contador â”€â”€â”€ */
    .char-count {
      font-size: 10px;
      color: var(--muted);
      text-align: right;
      margin-top: 4px;
    }

    .char-count.warn {
      color: #c0392b;
    }

    /* â”€â”€â”€ BotÃ³n agregar ingrediente â”€â”€â”€ */
    .add-btn {
      width: 100%;
      background: transparent;
      border: 1.5px dashed var(--border);
      border-radius: 8px;
      padding: 9px;
      font-family: 'Jost', sans-serif;
      font-size: 11px;
      color: var(--muted);
      cursor: pointer;
      letter-spacing: 0.1em;
      transition: all 0.2s;
      margin-top: 8px;
    }

    .add-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(59, 197, 178, 0.04);
    }

    /* â”€â”€â”€ Lista ingredientes dinÃ¡mica â”€â”€â”€ */
    #ingredients-list {
      margin-bottom: 8px;
    }

    .ing-item {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .ing-item input {
      flex: 1;
      background: #fff;
      border: 1.5px solid var(--border);
      border-radius: 6px;
      padding: 8px 10px;
      font-family: 'Jost', sans-serif;
      font-size: 12px;
      color: var(--text);
    }

    .ing-item input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(59, 197, 178, 0.15);
    }

    .del-btn {
      background: #fef0f0;
      border: 1px solid #f5c6c6;
      color: #c0392b;
      border-radius: 6px;
      width: 28px;
      height: 28px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 0.15s;
    }

    .del-btn:hover {
      background: #fdd;
    }

    /* ========= PREVIEW ========= */
    .preview-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }

    .preview-label-wrap {
      font-size: 10px;
      color: var(--muted);
      letter-spacing: 0.2em;
      text-transform: uppercase;
      text-align: center;
    }

    /* â”€â”€â”€ Contenedor de stickers â”€â”€â”€ */
    .stickers-container {
      display: flex;
      align-items: flex-start;
      gap: 40px;
      justify-content: center;
    }

    .sticker-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .sticker-wrapper .btn-download {
      margin-top: 4px;
    }

    .sticker-label {
      font-size: 10px;
      color: var(--accent2);
      letter-spacing: 0.3em;
      text-transform: uppercase;
      font-weight: 600;
      text-align: center;
    }

    /* â”€â”€â”€ Imagen frontal â”€â”€â”€ */
    .front-img-container {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3;
      pointer-events: none;
    }

    .front-img-container img {
      max-width: 100%;
      max-height: 100%;
    }

    /* â”€â”€â”€ La etiqueta circular â”€â”€â”€ */
    .sticker {
      border-radius: 50%;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.14);
      flex-shrink: 0;
      transition: width 0.3s, height 0.3s;
    }

    .sticker .ring-outer {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      border: 2.5px solid #111;
      pointer-events: none;
      z-index: 4;
    }

    .sticker .ring-inner {
      position: absolute;
      border-radius: 50%;
      border: 1px solid #222;
      pointer-events: none;
      z-index: 4;
    }

    .sticker .watermark {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
      pointer-events: none;
    }

    .sticker .watermark img {
      width: auto;
      height: auto;
      mix-blend-mode: multiply;
      transition: opacity 0.3s;
    }

    .sticker .content {
      position: relative;
      z-index: 3;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      width: 100%;
      height: 100%;
      justify-content: center;
    }

    /* tipografÃ­a de la etiqueta */
    .lbl-header {
      font-family: 'Cormorant Garamond', serif;
      font-weight: 600;
      color: #111;
      letter-spacing: 0.06em;
      line-height: 1.1;
      white-space: pre-line;
    }

    .line-deco {
      display: flex;
      align-items: center;
      gap: 5px;
      margin: 5px 0;
    }

    .line-deco span {
      height: 1px;
      background: #222;
      display: block;
    }

    .line-deco i {
      width: 4px;
      height: 4px;
      background: #222;
      border-radius: 50%;
      display: block;
    }

    .lbl-body {
      color: #333;
      line-height: 1.7;
      font-weight: 300;
      font-family: 'Jost', sans-serif;
    }

    .lbl-body b {
      font-weight: 500;
      color: #111;
    }

    .expiry-row {
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .expiry-lbl {
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: #888;
    }

    .expiry-val {
      font-family: 'Cormorant Garamond', serif;
      font-weight: 600;
      letter-spacing: 0.12em;
      color: #111;
    }

    .line-thin {
      background: #ccc;
      margin: 0 auto;
    }

    .lbl-website {
      color: #444;
      letter-spacing: 0.13em;
      font-family: 'Jost', sans-serif;
    }

    /* â”€â”€â”€ Nota â”€â”€â”€ */
    .tip-box {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px 18px;
      font-size: 11px;
      color: var(--muted);
      line-height: 1.7;
      max-width: 300px;
      text-align: center;
    }

    .tip-box strong {
      color: var(--accent);
      display: block;
      margin-bottom: 4px;
      font-size: 10px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    /* ========= PRINT STYLES ========= */
    @media print {
      @page {
        margin: 0;
        size: auto;
      }

      body * {
        visibility: hidden;
      }

      #print-zone,
      #print-zone * {
        visibility: visible;
      }

      #print-zone {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .sticker {
        box-shadow: none !important;
      }

      .sticker-label {
        display: none !important;
      }
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <div class="logo">
      <img class="hlogo"
        src="https://raw.githubusercontent.com/DanielEstrada1352/armonia_en_mi_piel/main/white_icon_transparent_background.png" />
      <div>
        <h1>Editor de Etiquetas</h1>
        <span class="sub">ArmonÃ­a en mi Piel</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn-print" onclick="imprimirEtiqueta()">âŠ• Imprimir Etiqueta</button>
    </div>
  </header>

  <!-- MAIN APP -->
  <div class="app">

    <!-- â”€â”€â”€ PANEL EDITOR â”€â”€â”€ -->
    <div class="editor-panel">

      <div class="panel-title">ConfiguraciÃ³n</div>

      <!-- TamaÃ±o -->
      <div class="field-group">
        <label>TamaÃ±o de etiqueta</label>
        <div class="size-selector">
          <div class="size-btn" data-mm="50" onclick="setSize(this,50)">
            <span class="sz">5 cm</span>
            <span class="sl">pequeÃ±a</span>
          </div>
          <div class="size-btn active" data-mm="65" onclick="setSize(this,65)">
            <span class="sz">6.5 cm</span>
            <span class="sl">estÃ¡ndar</span>
          </div>
          <div class="size-btn" data-mm="80" onclick="setSize(this,80)">
            <span class="sz">8 cm</span>
            <span class="sl">grande</span>
          </div>
        </div>
      </div>

      <div class="divider-label">Contenido</div>

      <!-- Cabecera / Nombre del producto -->
      <div class="field-group">
        <label>Cabecera (nombre del producto)</label>
        <input type="text" id="inp-header" value="Pasta Dental" maxlength="40" oninput="update()"
          placeholder="Ej: Pasta Dental">
        <div class="char-count" id="cc-header">0 / 40</div>
      </div>

      <!-- Website -->
      <div class="field-group">
        <label>Sitio web</label>
        <input type="text" id="inp-website" value="www.armoniaenmipiel.com" maxlength="50" oninput="update()"
          placeholder="www.tudominio.com">
      </div>

      <div class="divider-label">Ingredientes</div>

      <!-- Lista dinÃ¡mica de ingredientes -->
      <div id="ingredients-list"></div>
      <button class="add-btn" onclick="addIngredient()">ï¼‹ Agregar ingrediente</button>

      <div class="divider-label">Caducidad</div>

      <!-- Caducidad -->
      <div class="field-group">
        <label>Fecha de caducidad</label>
        <input type="text" id="inp-expiry" value="15 / 08 / 2026" maxlength="20" oninput="update()"
          placeholder="Ej: 15 / 08 / 2026 o 08/2026">
      </div>

      <div class="divider-label">Opciones</div>

      <!-- Toggle logo -->
      <div class="toggle-row">
        <span>Mostrar logo de fondo</span>
        <label class="toggle">
          <input type="checkbox" id="tog-logo" checked onchange="update()">
          <div class="toggle-track"></div>
        </label>
      </div>

    </div>

    <!-- â”€â”€â”€ ÃREA PREVIEW â”€â”€â”€ -->
    <div class="preview-area">
      <div class="preview-label-wrap">Vista previa en tiempo real</div>

      <!-- ZONA DE IMPRESIÃ“N -->
      <div id="print-zone">
        <div class="stickers-container">
          <!-- STICKER FRONTAL (izquierda) -->
          <div class="sticker-wrapper">
            <div class="sticker" id="sticker-front">
              <div class="ring-outer"></div>
              <div class="ring-inner" id="ring-inner-front"></div>
              <div class="front-img-container">
                <img id="front-logo-img"
                  src="https://raw.githubusercontent.com/DanielEstrada1352/armonia_en_mi_piel/main/black_logo_transparent_background.png"
                  alt="Logo ArmonÃ­a en mi Piel">
              </div>
            </div>
            <div class="sticker-label">Vista Frontal</div>
            <button class="btn-download" onclick="descargarImagen('sticker-front', 'frontal')">â¬‡ Descargar
              Frontal</button>
          </div>
          <!-- STICKER TRASERO (derecha) -->
          <div class="sticker-wrapper">
            <div class="sticker" id="sticker">
              <div class="ring-outer"></div>
              <div class="ring-inner" id="ring-inner"></div>
              <div class="watermark" id="watermark">
                <img id="wm-img"
                  src="https://raw.githubusercontent.com/DanielEstrada1352/armonia_en_mi_piel/main/black_icon_transparent_background.png"
                  alt="Logo ArmonÃ­a en mi Piel">
              </div>
              <div class="content" id="label-content">
                <!-- generado por JS -->
              </div>
            </div>
            <div class="sticker-label">Vista Trasera</div>
            <button class="btn-download" onclick="descargarImagen('sticker', 'trasera')">â¬‡ Descargar Trasera</button>
          </div>
        </div>
      </div>

    </div><!-- /preview-area -->
  </div>

  <div class="tip-box">
    <strong>ðŸ’¡ CÃ³mo imprimir</strong>
    Haz clic en "Imprimir Etiqueta" â†’ en la ventana de impresiÃ³n activa <em>Sin mÃ¡rgenes</em> y <em>Escala al
      100%</em>. Para PDF, elige "Guardar como PDF".
  </div>

  </div>
  </div>

  <script>
    // â”€â”€â”€ Estado â”€â”€â”€
    const LOGO_B64 = document.getElementById('wm-img').src;

    // Ingredientes iniciales
    const defaultIngredients = [
      'CarbÃ³n activado',
      'Bicarbonato',
      'Aceite de coco',
      'Aceite de menta',
      'Carbonato de calcio',
      'Xilitol'
    ];

    let currentSizeMM = 65;
    // DPI de pantalla: 1mm â‰ˆ 3.779px
    const MM_TO_PX = 3.779;

    function mmToPx(mm) { return Math.round(mm * MM_TO_PX); }

    // â”€â”€â”€ Init â”€â”€â”€
    window.onload = function () {
      //document.getElementById('front-logo-img').src = LOGO_B64;
      defaultIngredients.forEach(ing => addIngredient(ing));
      applySizes();
      update();
    };


    // â”€â”€â”€ TamaÃ±o â”€â”€â”€
    function setSize(btn, mm) {
      document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentSizeMM = mm;
      applySizes();
      update();
    }

    function applySizes() {
      const px = mmToPx(currentSizeMM);

      // Sticker trasero
      const sticker = document.getElementById('sticker');
      sticker.style.width = px + 'px';
      sticker.style.height = px + 'px';

      // Sticker frontal
      const stickerFront = document.getElementById('sticker-front');
      stickerFront.style.width = px + 'px';
      stickerFront.style.height = px + 'px';

      // anillo interior trasero ~inset 4% del diÃ¡metro
      const inset = Math.round(px * 0.04);
      const ring = document.getElementById('ring-inner');
      ring.style.inset = inset + 'px';

      // anillo interior frontal
      const ringFront = document.getElementById('ring-inner-front');
      ringFront.style.inset = inset + 'px';

      // imagen watermark ~55% del diÃ¡metro
      const wmImg = document.getElementById('wm-img');
      const wmSize = Math.round(px * 0.805);
      wmImg.style.maxWidth = wmSize + 'px';
      wmImg.style.maxHeight = wmSize + 'px';
    }

    // â”€â”€â”€ Ingredientes dinÃ¡micos â”€â”€â”€
    function addIngredient(val = '') {
      const list = document.getElementById('ingredients-list');
      const row = document.createElement('div');
      row.className = 'ing-item';
      row.innerHTML = `
    <input type="text" value="${val}" placeholder="Ej: Aceite de argÃ¡n" oninput="update()" maxlength="40">
    <button class="del-btn" onclick="removeIng(this)" title="Eliminar">Ã—</button>
  `;
      list.appendChild(row);
      update();
    }

    function removeIng(btn) {
      btn.parentElement.remove();
      update();
    }

    // â”€â”€â”€ Actualizar preview â”€â”€â”€
    function update() {
      const header = document.getElementById('inp-header').value || 'Producto';
      const website = document.getElementById('inp-website').value || '';
      const expiry = document.getElementById('inp-expiry').value || 'â€”';
      const showLogo = document.getElementById('tog-logo').checked;

      // Contador cabecera
      const hLen = header.length;
      const ccH = document.getElementById('cc-header');
      ccH.textContent = hLen + ' / 40';
      ccH.className = 'char-count' + (hLen > 35 ? ' warn' : '');

      // Logo
      document.getElementById('wm-img').style.opacity = showLogo ? '0.085' : '0';

      // Ingredientes
      const inputs = document.querySelectorAll('#ingredients-list input');
      const ings = Array.from(inputs).map(i => i.value.trim()).filter(Boolean);

      // Escala de fuentes segÃºn tamaÃ±o
      const scale = currentSizeMM / 65; // normalizado a 65mm
      const fs = {
        header: Math.round(17 * scale),
        body: Math.round(7.5 * scale),
        expLbl: Math.round(6.5 * scale),
        expVal: Math.round(11 * scale),
        website: Math.round(7 * scale),
        deco: Math.round(40 * scale),
        decoI: Math.round(4 * scale),
        decoGap: Math.round(5 * scale),
        thin: Math.round(55 * scale),
        pad: Math.round(30 * scale),
      };

      // Formatear cuerpo: lÃ­neas de 2 ingredientes
      let bodyLines = '';
      for (let i = 0; i < ings.length; i += 2) {
        const pair = ings.slice(i, i + 2);
        // primer ingrediente en negrita
        const first = `<b>${pair[0]}</b>`;
        const rest = pair.slice(1).join(' Â· ');
        bodyLines += (rest ? first + ' Â· ' + rest : first) + '<br>';
      }

      const px = mmToPx(currentSizeMM);

      const html = `
    <div class="lbl-header" style="font-size:${fs.header}px; max-width:${px * 0.72}px;">${header}</div>
    <div class="line-deco" style="gap:${fs.decoGap}px; margin:${Math.round(4 * scale)}px 0;">
      <span style="width:${fs.deco}px;"></span>
      <i style="width:${fs.decoI}px; height:${fs.decoI}px;"></i>
      <span style="width:${fs.deco}px;"></span>
    </div>
    <div class="lbl-body" style="font-size:${fs.body}px; max-width:${px * 0.7}px; margin-bottom:${Math.round(3 * scale)}px;">${bodyLines}</div>
    <div class="expiry-row" style="gap:${Math.round(4 * scale)}px; margin:${Math.round(4 * scale)}px 0;">
      <span class="expiry-lbl" style="font-size:${fs.expLbl}px;">Cad.</span>
      <span class="expiry-val" style="font-size:${fs.expVal}px;">${expiry}</span>
    </div>
    <div class="line-thin" style="width:${fs.thin}px; height:1px; margin:${Math.round(4 * scale)}px auto;"></div>
    <div class="lbl-website" style="font-size:${fs.website}px;">${website}</div>
  `;

      document.getElementById('label-content').innerHTML = html;
      // padding del content proporcional
      document.getElementById('label-content').style.padding = `${fs.pad}px ${Math.round(fs.pad * 1.1)}px`;
    }

    // â”€â”€â”€ Imprimir â”€â”€â”€
    function imprimirEtiqueta() {
      window.print();
    }

    // â”€â”€â”€ Convertir imagen externa a base64 â”€â”€â”€
    function imgToBase64(imgEl) {
      return fetch(imgEl.src)
        .then(res => res.blob())
        .then(blob => new Promise((resolve) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result);
          reader.readAsDataURL(blob);
        }));
    }

    // â”€â”€â”€ Descargar como imagen â”€â”€â”€
    function descargarImagen(stickerId, label) {
      const stickerEl = document.getElementById(stickerId);
      const productName = (document.getElementById('inp-header').value || 'etiqueta').trim().toLowerCase().replace(/\s+/g, '-');

      // Encontrar todas las imÃ¡genes externas dentro del sticker
      const imgs = stickerEl.querySelectorAll('img');
      const origSrcs = Array.from(imgs).map(img => img.src);

      // Convertir todas las imÃ¡genes a base64 antes de capturar
      Promise.all(Array.from(imgs).map(img => imgToBase64(img).then(b64 => { img.src = b64; })))
        .then(() => {
          // Ocultar bordes circulares para la descarga
          const ringsOuter = stickerEl.querySelectorAll('.ring-outer');
          const ringsInner = stickerEl.querySelectorAll('.ring-inner');
          ringsOuter.forEach(r => r.style.display = 'none');
          ringsInner.forEach(r => r.style.display = 'none');

          return html2canvas(stickerEl, {
            backgroundColor: null,
            scale: 3,
            useCORS: true,
            logging: false
          }).then(function (canvas) {
            // Restaurar bordes circulares
            ringsOuter.forEach(r => r.style.display = '');
            ringsInner.forEach(r => r.style.display = '');

            // Restaurar URLs originales
            imgs.forEach((img, i) => { img.src = origSrcs[i]; });

            const link = document.createElement('a');
            link.download = 'etiqueta-' + productName + '-' + label + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
          });
        })
        .catch(err => {
          // Restaurar URLs originales en caso de error
          imgs.forEach((img, i) => { img.src = origSrcs[i]; });
          console.error('Error al descargar:', err);
          alert('Error al generar la imagen. Intenta de nuevo.');
        });
    }
  </script>
</body>

</html>